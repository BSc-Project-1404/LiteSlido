{% extends 'base.html' %}
{% block title %}Create Poll â€” LiteSlido{% endblock %}

{% block content %}
  <div class="max-w-xl mx-auto bg-white p-6 rounded-lg shadow mt-20">
    <h2 class="text-2xl font-bold mb-4">Create Poll for "{{ event.title }}"</h2>

    {# Non-field errors (e.g. generic form errors) #}
    {% if form.non_field_errors %}
      <div class="mb-4 p-3 bg-red-100 text-red-800 rounded">
        <ul class="list-disc list-inside">
          {% for err in form.non_field_errors %}
            <li>{{ err }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    <form method="post" class="space-y-4">
      {% csrf_token %}

      <!-- Question Field -->
      <div>
        <label for="id_question" class="block text-sm font-medium mb-1">
          Poll Question
        </label>
        {{ form.question }}
        {% if form.question.errors %}
          <p class="mt-1 text-sm text-red-600">{{ form.question.errors.0 }}</p>
        {% endif %}
      </div>

      <!-- Options -->
      <h3 class="text-lg font-semibold">Options</h3>
      <div id="options-container" class="space-y-3">
        {% for optform in option_forms %}
          <div class="flex items-center space-x-2">
            <input type="text"
                   name="{{ optform.prefix }}-text"
                   id="id_{{ optform.prefix }}-text"
                   class="flex-1 border rounded px-3 py-2 focus:outline-none focus:ring"
                   placeholder="Option {{ forloop.counter }}"
                   required>
          </div>
        {% endfor %}
      </div>

      <!-- Add Option Button -->
      <button type="button"
              id="add-option-button"
              class="inline-flex items-center px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition">
        + Add Option
      </button>

      <!-- Hidden num_options -->
      <input type="hidden" name="num_options" id="num-options" value="{{ num_options }}">

      <!-- Submit -->
      <button type="submit"
              class="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
        Create Poll
      </button>
    </form>
  </div>

  <script>
    let numOptions = {{ num_options }};
    document.getElementById('add-option-button').addEventListener('click', () => {
      numOptions++;
      const container = document.getElementById('options-container');
      const div = document.createElement('div');
      div.className = 'flex items-center space-x-2';
      div.innerHTML = `
        <input type="text"
               name="option_${numOptions}-text"
               id="id_option_${numOptions}-text"
               class="flex-1 border rounded px-3 py-2 focus:outline-none focus:ring"
               placeholder="Option ${numOptions}"
               required>
      `;
      container.appendChild(div);
      document.getElementById('num-options').value = numOptions;
    });
  </script>
{% endblock %}
